<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        canvas {
            border: 3px solid black;
        }
        .vbox {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .hbox {
            display: flex;
            flex-direction: row;
            align-items: baseline;
        }
    </style>
</head>
<body>

<div class="vbox">
    <div class="hbox" id="commands">
        <button id="redraw">redraw</button>
        <button id="clear">clear</button>
        <button id="tear">tear off new sheet</button>
    </div>
    <div class="hbox" id="colors">
        <label>colors</label>
        <button id="gray">gray</button>
        <button id="black">black</button>
        <button id="red">red</button>
        <button id="blue">blue</button>
    </div>
    <div class="hbox" id="widths">
        <label>stroke widths</label>
        <button id="width1">1</button>
        <button id="width2">2</button>
        <button id="width3">4</button>
        <button id="width4">8</button>
    </div>
    <canvas id="canvas" width="500" height="500"></canvas>
</div>


<!--<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.27.6.js"></script>-->
<script src="../node_modules/pubnub/dist/web/pubnub.js"></script>
<script type="module">
  import { SketchCanvasSender } from "../src/components/sketchcanvas-sender.js";

  const sc = new SketchCanvasSender()

  const $ = (sel) => document.querySelector(sel)
  const $$ = (sel) => document.querySelectorAll(sel)
  const on = (el,type,cb) => el.addEventListener(type,cb)

  const e2pt = (evt) => {
    let r = evt.target.getBoundingClientRect()
    return {
      x: evt.clientX - r.x,
      y: evt.clientY - r.y,
    }
  }

  let pressed = false

  on($("#canvas"),'mousedown',(e)=>{
    pressed = true
    sc.startStroke(e2pt(e))
  })
  on($("#canvas"),'mousemove',(e)=>{
    if(!pressed)return
    sc.dragStroke(e2pt(e))
    sc.redraw($("#canvas"))
  })
  on($("#canvas"),'mouseup',(e)=>{
    pressed = false
    sc.endStroke(e2pt(e))
  })

  $$("#widths button").forEach((btn,i) => {
    on(btn,'click',()=>{
      sc.setStrokeWidth(Math.pow(2,i))
    })
  })
  $$("#colors button").forEach((btn,i) => {
    on(btn,'click',()=>{
      sc.setStrokeColor(btn.id)
    })
  })

  on($("#redraw"),'click',()=>{
    sc.redraw($("#canvas"))
  })
  on($("#clear"),'click',()=>{
    sc.clear()
    sc.redraw($("#canvas"))
  })
  on($("#tear"),'click',()=>{
    sc.tear()
  })
</script>
</body>
</html>
